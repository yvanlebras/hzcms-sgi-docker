# Secure HUBzero Website Definition
#
# DO NOT MODIF THIS FILE DIRECTLY!!!!
# This file is automatically generated from /etc/apache2/sites-m4/example
# and can get recreated on demand by 'hzcms' and other tools



<VirtualHost *:443>
	DocumentRoot /var/www/example
	TraceEnable off
	RewriteEngine on
	ServerSignature off
	ServerName c5ff346549e7

	RewriteRule ^(.*/)?(\.svn|\.git|\.hg)/ - [R=404,L]

  # -------------------------------------------------------
  # We need proxying for any non HubZero integration via URL
  # -------------------------------------------------------
  #
  #ProxyTimeout 2400
  #Timeout 2400
  ProxyRequests Off
  ProxyVia Off
  ProxyPreserveHost On
  ProxyBadHeader Ignore

  <Proxy *>
          Order Deny,Allow
          Allow from all
  </Proxy>

  # JWT Service
  ProxyPass /a/jwt/ http://localhost:8080/jwt/
  ProxyPass /a/upl/ http://localhost:8080/uploader/
  ProxyPass /a/dll/ http://localhost:8080/dll/
  ProxyPass /a/dlc/ http://localhost:8080/dllcompliance/

  # redirecting back to the host:
  ProxyPass /al/jwt/ http://10.200.10.1:8082/
  ProxyPass /al/upl/ http://10.200.10.1:8084/
  ProxyPass /al/dll/ http://10.200.10.1:8081/
  ProxyPass /al/dlc/ http://10.200.10.1:8083/
  #
  # ------------------------------------------------------
  # ------------------------------------------------------

	<Directory />
		Order Deny,Allow
		Deny from all
		Options None
		AllowOverride None
	</Directory>

	<Directory /var/www/example/api>
		RewriteEngine On
		Order Allow,Deny
		Allow from all
		Options FollowSymLinks
		AllowOverride None
		DirectoryIndex index.php index.html
		RewriteCond %{REQUEST_FILENAME} !-f
		RewriteCond %{REQUEST_FILENAME} !-d
		RewriteRule (.*) index.php
		Satisfy Any
		php_flag magic_quotes_gpc off
	</Directory>

	<Directory /var/www/example>
		RewriteEngine On
		Order Allow,Deny
		Allow from all
		Options FollowSymLinks
		AllowOverride None
		DirectoryIndex index.php index.html

		RewriteCond %{REQUEST_FILENAME} !-f
		RewriteCond %{REQUEST_FILENAME} !-d
		RewriteRule (.*) index.php
	</Directory>

	<Directory /var/www/example/site/protected>
		Order Deny,Allow
		Deny from All
		Options None
		AllowOverride None
	</Directory>

	LogLevel warn
	LogFormat "%{%Y-%m-%d %H:%M:%S %Z}t %P %u \"%r\" %>s %B %a \"%{Referer}i\" \"%{User-Agent}i\" %{SSL_PROTOCOL}x %T %D %{userid}n %{jsession}n %{site}C %{auth}n %{component}n %{view}n %{task}n %{action}n %{item}n" hublog
	ErrorLog ${APACHE_LOG_DIR}/dev-error-ssl.log
	CustomLog ${APACHE_LOG_DIR}/dev-access.log hublog

	SSLEngine On
	SSLHonorCipherOrder On
	SSLCipherSuite HIGH:!aNULL:!eNULL
	SSLProtocol all -SSLv2 -SSLv3
	SSLCertificateFile /etc/ssl/certs/ssl-cert-snakeoil.pem
	SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key

	<Location /site>
		AddType text/plain .php .phtml .pht .phps .php3 .php3p .php4 .php5 .php6
		php_admin_value engine Off
	</Location>

	AddType application/x-font-ttf .ttf
	AddType application/vnd.ms-fontobject .eot
	AddType application/x-font-opentype .otf
	AddType application/x-font-woff .woff

</VirtualHost>


